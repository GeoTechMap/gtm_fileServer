(this["webpackJsonp@coreui/coreui-free-react-admin-template"]=this["webpackJsonp@coreui/coreui-free-react-admin-template"]||[]).push([[14],{685:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i(40),c=i(173),a=i(174),s=(i(1),i(67)),o=i(684),r=i(10),l=function(e){var t=e.label,i=e.type,l=e.options,d=Object(a.a)(e,["label","type","options"]),u=Object(o.d)(d),m=Object(c.a)(u,2),h=m[0],j=m[1];return Object(r.jsxs)("div",{className:"mb-2",children:[Object(r.jsx)("label",{htmlFor:h.name,children:t}),"textarea"===i?Object(r.jsx)("textarea",Object(n.a)(Object(n.a)({className:"form-control shadow-none ".concat(j.touched&&j.error&&"is-invalid"),placeholder:"Veuillez entrer la description...",rows:"6"},h),d)):"select"===i?Object(r.jsxs)(s.N,Object(n.a)(Object(n.a)(Object(n.a)({name:t,className:"form-control shadow-none ".concat(j.touched&&j.error&&"is-invalid")},h),d),{},{children:[Object(r.jsx)("option",{value:0,children:"Choisir"}),l.map((function(e,t){return Object(r.jsx)("option",{value:e.id,children:e.nom},t)}))]})):"selectString"===i?Object(r.jsxs)(s.N,Object(n.a)(Object(n.a)(Object(n.a)({name:t,className:"form-control shadow-none ".concat(j.touched&&j.error&&"is-invalid")},h),d),{},{children:[Object(r.jsx)("option",{value:0,children:"Choisir"}),l.map((function(e,t){return Object(r.jsx)("option",{value:e,children:e},t)}))]})):Object(r.jsx)("input",Object(n.a)(Object(n.a)({className:"form-control shadow-none ".concat(j.touched&&j.error&&"is-invalid")},h),d)),Object(r.jsx)(o.a,{component:"div",name:h.name,style:{position:"absolute",color:"red",fontSize:".6rem"}})]})}},898:function(e,t,i){"use strict";i.r(t);var n=i(40),c=i(173),a=i(1),s=i.n(a),o=i(684),r=i(685),l=i(703),d=i(67),u=i(44),m=i(680),h=i.n(m),j=i(176),b=i(10);t.default=function(e){var t=e.match,i=Object(a.useState)(!1),m=Object(c.a)(i,2),p=m[0],O=m[1],f=Object(a.useState)(!1),x=Object(c.a)(f,2),y=x[0],g=x[1],C=Object(a.useContext)(j.a),N=Object(c.a)(C,2),E=N[0];N[1];Object(a.useEffect)((function(){fetch("".concat("http://localhost:8080","/api/type_essais/")).then((function(e){return e.json()})).then((function(e){return _(e),e})),ne([{id:"Artibonite",nom:"Artibonite"},{id:"Centre",nom:"Centre"},{id:"Grand'Anse",nom:"Grand'Anse"},{id:"Nippes",nom:"Nippes"},{id:"Nord",nom:"Nord"},{id:"Nord-Est",nom:"Nord-Est"},{id:"Nord-Ouest",nom:"Nord-Ouest"},{id:"Ouest",nom:"Ouest"},{id:"Sud-Est",nom:"Sud-Est"},{id:"Sud",nom:"Sud"}]),$([{id:E.connectedUser?E.connectedUser.institution.id:null,nom:E.connectedUser?E.connectedUser.institution.nom:null}]),t.params.id&&fetch("".concat("http://localhost:8080","/api/essais/")+t.params.id).then((function(e){return e.json()})).then((function(e){return G({id:e.id,typeEssai:e.typeEssai.id,institution:e.institution.id,latitude:e.position.latitude,longitude:e.position.longitude,altitude:e.position.altitude,departement:e.position.departement,commune:e.position.commune,sectionCommunale:e.position.sectionCommunale,commentaire:e.commentaire,code:e.code,dateRealisation:e.dateRealisation,motsCles:e.motsCles,pdf:"",idPosition:e.position.id,idFichier:e.fichier.id,nomFichier:e.fichier.nom}),e})).then((function(e){return q(e.fichier.hashNomFichier),e})).then((function(e){return z(Object(n.a)(Object(n.a)({},F),{},{file:{id:e.fichier.id,name:e.fichier.nom,type:e.fichier.format,size:e.fichier.capacite}})),e})).then((function(e){return fetch("".concat("http://localhost:8081","/api/file/getfile"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({nomFichier:e.fichier.nom,hashNomFichier:e.fichier.hashNomFichier,hashBase64:e.fichier.hashPdf})}).then((function(e){return e.json()})).then((function(e){return R(Object(n.a)(Object(n.a)({},P),{},{pdf:e.base64File})),e})).then((function(t){z({file:{id:e.fichier.id,name:e.fichier.nom,type:e.fichier.format,size:e.fichier.capacite}})})).then((function(){return me(!0)})).catch((function(e){console.error("Error:",e)})),e}))}),[t.params.id,P,F,E]);var S=Object(a.useState)({file:null}),v=Object(c.a)(S,2),F=v[0],z=v[1],k=Object(a.useState)(),A=Object(c.a)(k,2),w=A[0],P=void 0===w?{typeEssai:{id:null},institution:{id:null},position:{id:null},fichier:{id:null},motsCles:"",code:"",pdf:""}:w,R=A[1],T=Object(a.useRef)(P);Object(a.useEffect)((function(){T.current=P}),[P]);var V=Object(a.useState)({typeEssai:"",institution:"",latitude:"",longitude:"",altitude:"",departement:"",commune:"",sectionCommunale:"",commentaire:"",code:"",dateRealisation:"",motsCles:"",pdf:""}),M=Object(c.a)(V,2),J=M[0],L=(M[1],Object(a.useState)("")),D=Object(c.a)(L,2),U=D[0],q=D[1],B=Object(a.useState)(null),H=Object(c.a)(B,2),I=H[0],G=H[1],X=Object(a.useState)([]),Y=Object(c.a)(X,2),Z=Y[0],_=Y[1],K=Object(a.useState)([]),Q=Object(c.a)(K,2),W=Q[0],$=Q[1],ee=Object(a.useState)([]),te=Object(c.a)(ee,2),ie=te[0],ne=te[1],ce=s.a.useState({isActive:!1,status:"",message:""}),ae=Object(c.a)(ce,2),se=ae[0],oe=(ae[1],l.b({typeEssai:l.a().max(99999999,"Maximum 45 caract\xe8res").min(1,"Faire un choix").required("Champs obligatoire"),institution:l.a().max(99999999,"Maximum 45 caract\xe8res").min(1,"Faire un choix").required("Champs obligatoire"),latitude:l.a("Entrer un nombre").min(17.5,"Latitude situ\xe9 en dehors d'Ha\xefti").max(21,"Latitude situ\xe9 en dehors d'Ha\xefti").required("Champs obligatoire"),longitude:l.a("Entrer un nombre").min(-75,"Latitude situ\xe9 en dehors d'Ha\xefti").max(-71.5,"Latitude situ\xe9 en dehors d'Ha\xefti").required("Champs obligatoire"),altitude:l.a("Entrer un nombre").max(99999999,"Maximum 255 caract\xe8res").required("Champs obligatoire"),commentaire:l.c().max(255,"Maximum 255 caract\xe8res"),code:l.c().max(255,"Maximum 255 caract\xe8res"),dateRealisation:l.c().max(20,"Maximum 20 caract\xe8res"),motsCles:l.c().max(255,"Maximum 255 caract\xe8res"),departement:l.c().max(255,"Maximum 255 caract\xe8res").required("Champs obligatoire")})),re=function(e){var t=e.currentTarget.files[0];z({file:e.target.files[0]}),function(e,t){var i=new FileReader;i.readAsDataURL(e),i.onload=function(){t(i.result)},i.onerror=function(e){console.log("Error: ",e)}}(t,(function(e){R(Object(n.a)(Object(n.a)({},P),{},{pdf:e.substr(e.indexOf(",")+1)}))})),me(!0)},le=Object(a.useState)(!1),de=Object(c.a)(le,2),ue=de[0],me=de[1],he=Object(a.useState)(!1),je=Object(c.a)(he,2),be=je[0],pe=je[1];return Object(b.jsxs)("div",{children:[Object(b.jsx)(o.c,{initialValues:I||J,enableReinitialize:!0,validationSchema:oe,onSubmit:function(e){if(pe(!0),ue){new Promise((function(e,t){e()})).then((function(){return new Promise((function(i,n){R({id:t.params.id?I.id:null,typeEssai:{id:e.typeEssai},institution:{id:e.institution},position:{id:t.params.id?I.idPosition:null,latitude:e.latitude,longitude:e.longitude,altitude:e.altitude,departement:e.departement},fichier:{id:t.params.id?I.idFichier:null,nom:F.file.name,format:F.file.type,capacite:F.file.size},commentaire:e.commentaire,code:e.code,dateRealisation:e.dateRealisation,motsCles:e.motsCles.concat(" "+e.departement).concat(" "+Z.filter((function(t){return t.id==e.typeEssai}))[0].nom).concat(" "+W.filter((function(t){return t.id==e.institution}))[0].nom).toLowerCase().split(" ").filter((function(e,t,i){return t==i.indexOf(e)})).join(" "),pdf:P.pdf,nomFichierASuprimmer:U}),R((function(e){return e})),i()}))})).then((function(){return new Promise((function(e,i){var n={method:t.params.id?"PUT":"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(u.a.getToken())},body:JSON.stringify(T.current)};console.log(T.current),t.params.id?fetch("".concat("http://localhost:8080","/api/essais/")+t.params.id,n).then((function(e){return e.json()})).then((function(e){fetch("".concat("http://localhost:8081","/api/file"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({hashNomFichier:e.essaiDto.fichier.hashNomFichier,nomFichierASuprimmer:U,base64:P.pdf})})})).then((function(){return O(!0)})).then((function(){return pe(!1)})).catch((function(e){console.log(e),g(!0),pe(!1)})):fetch("".concat("http://localhost:8080","/api/essais"),n).then((function(e){return e.json()})).then((function(e){fetch("".concat("http://localhost:8081","/api/file"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({hashNomFichier:e.essaiDto.fichier.hashNomFichier,nomFichierASuprimmer:"",base64:P.pdf})})})).then((function(){return O(!0)})).then((function(){return pe(!1)})).catch((function(e){console.log(e),g(!0),pe(!1)})),e()}))})),setTimeout((function(){O(!1),g(!1)}),3e3)}else console.log("no document")},children:function(e){return Object(b.jsx)("div",{children:Object(b.jsxs)(o.b,{children:[se.isActive?Object(b.jsx)(d.a,{color:"info",closeButton:!0,children:se.message}):"",Object(b.jsxs)(d.M,{children:[Object(b.jsx)(d.l,{xs:"12",sm:"6",children:Object(b.jsxs)(d.g,{children:[Object(b.jsxs)(d.k,{children:["Informations sur l'essai   ",t.params.id]}),Object(b.jsxs)(d.h,{children:[Object(b.jsxs)(d.x,{children:[Object(b.jsx)(r.a,{label:"Type d'essai*:",name:"typeEssai",type:"select",options:Z,placeholder:"Entrer le type d'essai..."}),Object(b.jsx)(d.y,{className:"help-block",children:"Veuillez entrer le type d'essai"})]}),Object(b.jsxs)(d.x,{children:[Object(b.jsx)(r.a,{label:"Institution*:",name:"institution",type:"select",options:W,placeholder:"Entrer l'institution"}),Object(b.jsx)(d.y,{className:"help-block",children:"Veuillez entrer l'institution"})]}),Object(b.jsxs)(d.x,{children:[Object(b.jsx)(r.a,{label:"Latitude*:",name:"latitude",type:"text",placeholder:"Entrer la latitude",autoComplete:"latitude"}),Object(b.jsx)(d.y,{className:"help-block",children:"Veuillez entrer la latitude (ex: 18.54)"})]}),Object(b.jsxs)(d.x,{children:[Object(b.jsx)(r.a,{label:"Longitude*:",name:"longitude",type:"text",placeholder:"Entrer la longitude",autoComplete:"longitude"}),Object(b.jsx)(d.y,{className:"help-block",children:"Veuillez entrer la longitude (ex: -72.68)"})]}),Object(b.jsxs)(d.x,{children:[Object(b.jsx)(r.a,{label:"Altitude*:",name:"altitude",type:"text",placeholder:"Entrer l'altitude",autoComplete:"altitude"}),Object(b.jsx)(d.y,{className:"help-block",children:"Veuillez entrer l'altitude (ex: 45)"})]}),Object(b.jsxs)(d.x,{children:[Object(b.jsx)(r.a,{label:"D\xe9partement*:",name:"departement",type:"select",options:ie,placeholder:"Entrer le d\xe9partement de l'essai..."}),Object(b.jsx)(d.y,{className:"help-block",children:"Veuillez entrer le d\xe9partement de l'essai"})]})]})]})}),Object(b.jsx)(d.l,{xs:"12",sm:"6",children:Object(b.jsxs)(d.g,{children:[Object(b.jsxs)(d.k,{children:["Informations sur l'essai   ",t.params.id]}),Object(b.jsxs)(d.h,{children:[Object(b.jsxs)(d.x,{children:[Object(b.jsx)(r.a,{label:"Date de r\xe9alisation: (jj/mm/aaaa)",name:"dateRealisation",type:"text",placeholder:"Entrer la date de r\xe9alisation de l'essai",autoComplete:"dateRealisation"}),Object(b.jsx)(d.y,{className:"help-block",children:"Veuillez entrer la date de r\xe9alisation de l'essai (format: Jour/Mois/Ann\xe9e)"})]}),Object(b.jsxs)(d.x,{children:[Object(b.jsx)(r.a,{label:"Code de l'essai:",name:"code",type:"text",placeholder:"Entrer le code de l'essai",autoComplete:"code"}),Object(b.jsx)(d.y,{className:"help-block",children:"Veuillez entrer le code de l'essai"})]}),Object(b.jsxs)(d.x,{children:[Object(b.jsx)(r.a,{label:"Mots cl\xe9s:",name:"motsCles",type:"textarea",placeholder:"Entrer les mots cl\xe9s",autoComplete:"motsCles"}),Object(b.jsx)(d.y,{className:"help-block",children:"Veuillez entrer les mots cl\xe9s"})]}),Object(b.jsxs)(d.x,{children:[Object(b.jsx)(r.a,{label:"Commentaires:",name:"commentaire",type:"textarea",placeholder:"Entrer les commentaires",autoComplete:"commentaire"}),Object(b.jsx)(d.y,{className:"help-block",children:"Veuillez entrer un commentaire"})]}),Object(b.jsx)(d.x,{row:!0,children:Object(b.jsxs)(d.l,{xs:"12",md:"12",children:[Object(b.jsx)("input",{id:"custom-file-input",type:"file",accept:"application/pdf",onChange:function(e){return re(e)}}),Object(b.jsx)(d.J,{htmlFor:"custom-file-input",variant:"custom-file",children:F.file?F.file.name:"Choisir un fichier..."})]})}),I||ue?"":Object(b.jsx)(d.x,{row:!0,children:Object(b.jsx)(d.l,{xs:"12",md:"12",children:Object(b.jsx)(d.y,{className:"help-block",children:Object(b.jsx)("span",{style:{color:"red"},children:"Choisir un PDF*"})})})})]}),I?Object(b.jsx)(d.x,{row:!0,children:Object(b.jsx)(d.l,{xs:"12",md:"12",children:Object(b.jsxs)(d.y,{className:"help-block",children:[" Ancien PDF:  ",I?I.nomFichier:""]})})}):"",Object(b.jsxs)(d.i,{children:[Object(b.jsxs)("button",{className:"btn btn-dark mt-3",type:"submit",disabled:be,children:[t.params.id?"Modifier":"Enregistrer",Object(b.jsx)(h.a,{loading:be,size:15})]}),Object(b.jsx)("button",{className:"btn btn-danger mt-3 ml-3",type:"reset",children:"R\xe9initialiser"})]})]})})]})]})})}}),Object(b.jsx)(d.l,{sm:"12",lg:"6",children:Object(b.jsx)(d.ab,{position:"top-right",children:Object(b.jsxs)(d.X,{show:p,autohide:4e3,fade:!0,children:[Object(b.jsx)(d.Z,{closeButton:!0,children:Object(b.jsx)(d.b,{className:"mr-1",color:"success",children:"SUCC\xc8S"})}),Object(b.jsx)(d.Y,{color:"success",children:"Op\xe9ration r\xe9ussie !"})]})})}),Object(b.jsx)(d.l,{sm:"12",lg:"6",children:Object(b.jsx)(d.ab,{position:"top-right",children:Object(b.jsxs)(d.X,{show:y,autohide:4e3,fade:!0,children:[Object(b.jsx)(d.Z,{closeButton:!0,children:Object(b.jsx)(d.b,{className:"mr-1",color:"danger",children:"ECHEC"})}),Object(b.jsx)(d.Y,{color:"success",children:"Echec de l'op\xe9ration. Veuillez essayer plus tard !"})]})})})]})}}}]);
//# sourceMappingURL=14.eeed835c.chunk.js.map