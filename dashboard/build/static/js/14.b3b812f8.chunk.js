(this["webpackJsonp@coreui/coreui-free-react-admin-template"]=this["webpackJsonp@coreui/coreui-free-react-admin-template"]||[]).push([[14],{685:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i(40),a=i(173),c=i(174),s=(i(1),i(67)),o=i(684),r=i(10),l=function(e){var t=e.label,i=e.type,l=e.options,d=Object(c.a)(e,["label","type","options"]),u=Object(o.d)(d),h=Object(a.a)(u,2),m=h[0],j=h[1];return Object(r.jsxs)("div",{className:"mb-2",children:[Object(r.jsx)("label",{htmlFor:m.name,children:t}),"textarea"===i?Object(r.jsx)("textarea",Object(n.a)(Object(n.a)({className:"form-control shadow-none ".concat(j.touched&&j.error&&"is-invalid"),placeholder:"Veuillez entrer la description...",rows:"6"},m),d)):"select"===i?Object(r.jsxs)(s.N,Object(n.a)(Object(n.a)(Object(n.a)({name:t,className:"form-control shadow-none ".concat(j.touched&&j.error&&"is-invalid")},m),d),{},{children:[Object(r.jsx)("option",{value:0,children:"Choisir"}),l.map((function(e,t){return Object(r.jsx)("option",{value:e.id,children:e.nom},t)}))]})):"selectString"===i?Object(r.jsxs)(s.N,Object(n.a)(Object(n.a)(Object(n.a)({name:t,className:"form-control shadow-none ".concat(j.touched&&j.error&&"is-invalid")},m),d),{},{children:[Object(r.jsx)("option",{value:0,children:"Choisir"}),l.map((function(e,t){return Object(r.jsx)("option",{value:e,children:e},t)}))]})):Object(r.jsx)("input",Object(n.a)(Object(n.a)({className:"form-control shadow-none ".concat(j.touched&&j.error&&"is-invalid")},m),d)),Object(r.jsx)(o.a,{component:"div",name:m.name,style:{position:"absolute",color:"red",fontSize:".6rem"}})]})}},898:function(e,t,i){"use strict";i.r(t);var n=i(40),a=i(173),c=i(1),s=i.n(c),o=i(684),r=i(685),l=i(703),d=i(67),u=i(44),h=i(680),m=i.n(h),j=i(176),p=i(10);t.default=function(e){var t=e.match,i=Object(c.useState)(!1),h=Object(a.a)(i,2),b=h[0],O=h[1],f=Object(c.useState)(!1),x=Object(a.a)(f,2),y=x[0],g=x[1],C=Object(c.useContext)(j.a),N=Object(a.a)(C,2),E=N[0];N[1];Object(c.useEffect)((function(){fetch("".concat("http://www.geotechmap.ueh.edu.ht","/api/type_essais/")).then((function(e){return e.json()})).then((function(e){return _(e),e})),fetch("".concat("http://www.geotechmap.ueh.edu.ht","/api/utilisateurs/search?username=").concat(u.a.getUsername())).then((function(e){return e.json()})).then((function(e){return $([{id:e.institution.id,nom:e.institution.nom}])})),ne([{id:"Artibonite",nom:"Artibonite"},{id:"Centre",nom:"Centre"},{id:"Grand'Anse",nom:"Grand'Anse"},{id:"Nippes",nom:"Nippes"},{id:"Nord",nom:"Nord"},{id:"Nord-Est",nom:"Nord-Est"},{id:"Nord-Ouest",nom:"Nord-Ouest"},{id:"Ouest",nom:"Ouest"},{id:"Sud-Est",nom:"Sud-Est"},{id:"Sud",nom:"Sud"}]),t.params.id&&fetch("".concat("http://www.geotechmap.ueh.edu.ht","/api/essais/")+t.params.id).then((function(e){return e.json()})).then((function(e){return G({id:e.id,typeEssai:e.typeEssai.id,institution:e.institution.id,latitude:e.position.latitude,longitude:e.position.longitude,altitude:e.position.altitude,departement:e.position.departement,commune:e.position.commune,sectionCommunale:e.position.sectionCommunale,commentaire:e.commentaire,code:e.code,dateRealisation:e.dateRealisation,motsCles:e.motsCles,pdf:"",idPosition:e.position.id,idFichier:e.fichier.id,nomFichier:e.fichier.nom}),e})).then((function(e){return B(e.fichier.hashNomFichier),e})).then((function(e){return F(Object(n.a)(Object(n.a)({},v),{},{file:{id:e.fichier.id,name:e.fichier.nom,type:e.fichier.format,size:e.fichier.capacite}})),e})).then((function(e){return fetch("".concat("http://admin.geotechmap.ueh.edu.ht","/api/file/getfile"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({nomFichier:e.fichier.nom,hashNomFichier:e.fichier.hashNomFichier,hashBase64:e.fichier.hashPdf})}).then((function(e){return e.json()})).then((function(e){return P(Object(n.a)(Object(n.a)({},M),{},{pdf:e.base64File})),e})).then((function(t){F({file:{id:e.fichier.id,name:e.fichier.nom,type:e.fichier.format,size:e.fichier.capacite}})})).then((function(){return he(!0)})).catch((function(e){console.error("Error:",e)})),e}))}),[t.params.id,M,v,E]);var S=Object(c.useState)({file:null}),w=Object(a.a)(S,2),v=w[0],F=w[1],z=Object(c.useState)(),k=Object(a.a)(z,2),A=k[0],M=void 0===A?{typeEssai:{id:null},institution:{id:null},position:{id:null},fichier:{id:null},motsCles:"",code:"",pdf:""}:A,P=k[1],R=Object(c.useRef)(M);Object(c.useEffect)((function(){R.current=M}),[M]);var T=Object(c.useState)({typeEssai:"",institution:"",latitude:"",longitude:"",altitude:"",departement:"",commune:"",sectionCommunale:"",commentaire:"",code:"",dateRealisation:"",motsCles:"",pdf:""}),V=Object(a.a)(T,2),D=V[0],J=(V[1],Object(c.useState)("")),L=Object(a.a)(J,2),q=L[0],B=L[1],H=Object(c.useState)(null),U=Object(a.a)(H,2),I=U[0],G=U[1],X=Object(c.useState)([]),Y=Object(a.a)(X,2),Z=Y[0],_=Y[1],K=Object(c.useState)([]),Q=Object(a.a)(K,2),W=Q[0],$=Q[1],ee=Object(c.useState)([]),te=Object(a.a)(ee,2),ie=te[0],ne=te[1],ae=s.a.useState({isActive:!1,status:"",message:""}),ce=Object(a.a)(ae,2),se=ce[0],oe=(ce[1],l.b({typeEssai:l.a().max(99999999,"Maximum 45 caract\xe8res").min(1,"Faire un choix").required("Champs obligatoire"),institution:l.a().max(99999999,"Maximum 45 caract\xe8res").min(1,"Faire un choix").required("Champs obligatoire"),latitude:l.a("Entrer un nombre").min(17.5,"Latitude situ\xe9 en dehors d'Ha\xefti").max(21,"Latitude situ\xe9 en dehors d'Ha\xefti").required("Champs obligatoire"),longitude:l.a("Entrer un nombre").min(-75,"Latitude situ\xe9 en dehors d'Ha\xefti").max(-71.5,"Latitude situ\xe9 en dehors d'Ha\xefti").required("Champs obligatoire"),altitude:l.a("Entrer un nombre").max(99999999,"Maximum 255 caract\xe8res").required("Champs obligatoire"),commentaire:l.c().max(255,"Maximum 255 caract\xe8res"),code:l.c().max(255,"Maximum 255 caract\xe8res"),dateRealisation:l.c().max(20,"Maximum 20 caract\xe8res"),motsCles:l.c().max(255,"Maximum 255 caract\xe8res"),departement:l.c().max(255,"Maximum 255 caract\xe8res").required("Champs obligatoire")})),re=function(e){var t=e.currentTarget.files[0];t.size<2000048?"application/pdf"===t.type?(F({file:e.target.files[0]}),function(e,t){var i=new FileReader;i.readAsDataURL(e),i.onload=function(){t(i.result)},i.onerror=function(e){console.log("Error: ",e)}}(t,(function(e){P(Object(n.a)(Object(n.a)({},M),{},{pdf:e.substr(e.indexOf(",")+1)}))})),he(!0)):console.log("Must choose a PDF file"):console.log("Max file size is 2 MB")},le=Object(c.useState)(!1),de=Object(a.a)(le,2),ue=de[0],he=de[1],me=Object(c.useState)(!1),je=Object(a.a)(me,2),pe=je[0],be=je[1];return Object(p.jsxs)("div",{children:[Object(p.jsx)(o.c,{initialValues:I||D,enableReinitialize:!0,validationSchema:oe,onSubmit:function(e){if(be(!0),ue){new Promise((function(e,t){e()})).then((function(){return new Promise((function(i,n){P({id:t.params.id?I.id:null,typeEssai:{id:e.typeEssai},institution:{id:e.institution},position:{id:t.params.id?I.idPosition:null,latitude:e.latitude,longitude:e.longitude,altitude:e.altitude,departement:e.departement},fichier:{id:t.params.id?I.idFichier:null,nom:v.file.name,format:v.file.type,capacite:v.file.size},commentaire:e.commentaire,code:e.code,dateRealisation:e.dateRealisation,motsCles:e.motsCles.concat(" "+e.departement).concat(" "+Z.filter((function(t){return t.id==e.typeEssai}))[0].nom).concat(" "+W.filter((function(t){return t.id==e.institution}))[0].nom).toLowerCase().split(" ").filter((function(e,t,i){return t==i.indexOf(e)})).join(" "),pdf:M.pdf,nomFichierASuprimmer:q}),P((function(e){return e})),i()}))})).then((function(){return new Promise((function(e,i){var n={method:t.params.id?"PUT":"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(u.a.getToken())},body:JSON.stringify(R.current)};console.log(R.current),t.params.id?fetch("".concat("http://www.geotechmap.ueh.edu.ht","/api/essais/")+t.params.id,n).then((function(e){return e.json()})).then((function(e){fetch("".concat("http://admin.geotechmap.ueh.edu.ht","/api/file"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({hashNomFichier:e.essaiDto.fichier.hashNomFichier,nomFichierASuprimmer:q,base64:M.pdf})})})).then((function(){return O(!0)})).then((function(){return be(!1)})).catch((function(e){console.log(e),g(!0),be(!1)})):fetch("".concat("http://www.geotechmap.ueh.edu.ht","/api/essais"),n).then((function(e){return e.json()})).then((function(e){fetch("".concat("http://admin.geotechmap.ueh.edu.ht","/api/file"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({hashNomFichier:e.essaiDto.fichier.hashNomFichier,nomFichierASuprimmer:"",base64:M.pdf})})})).then((function(){return O(!0)})).then((function(){return be(!1)})).catch((function(e){console.log(e),g(!0),be(!1)})),e()}))})),setTimeout((function(){O(!1),g(!1)}),3e3)}else console.log("no document"),be(!1)},children:function(e){return Object(p.jsx)("div",{children:Object(p.jsxs)(o.b,{children:[se.isActive?Object(p.jsx)(d.a,{color:"info",closeButton:!0,children:se.message}):"",Object(p.jsxs)(d.M,{children:[Object(p.jsx)(d.l,{xs:"12",sm:"6",children:Object(p.jsxs)(d.g,{children:[Object(p.jsxs)(d.k,{children:["Informations sur l'essai   ",t.params.id]}),Object(p.jsxs)(d.h,{children:[Object(p.jsxs)(d.x,{children:[Object(p.jsx)(r.a,{label:"Type d'essai*:",name:"typeEssai",type:"select",options:Z,placeholder:"Entrer le type d'essai..."}),Object(p.jsx)(d.y,{className:"help-block",children:"Veuillez entrer le type d'essai"})]}),Object(p.jsxs)(d.x,{children:[Object(p.jsx)(r.a,{label:"Institution*:",name:"institution",type:"select",options:W,placeholder:"Entrer l'institution"}),Object(p.jsx)(d.y,{className:"help-block",children:"Veuillez entrer l'institution"})]}),Object(p.jsxs)(d.x,{children:[Object(p.jsx)(r.a,{label:"Latitude*:",name:"latitude",type:"text",placeholder:"Entrer la latitude",autoComplete:"latitude"}),Object(p.jsx)(d.y,{className:"help-block",children:"Veuillez entrer la latitude (ex: 18.54)"})]}),Object(p.jsxs)(d.x,{children:[Object(p.jsx)(r.a,{label:"Longitude*:",name:"longitude",type:"text",placeholder:"Entrer la longitude",autoComplete:"longitude"}),Object(p.jsx)(d.y,{className:"help-block",children:"Veuillez entrer la longitude (ex: -72.68)"})]}),Object(p.jsxs)(d.x,{children:[Object(p.jsx)(r.a,{label:"Altitude*:",name:"altitude",type:"text",placeholder:"Entrer l'altitude",autoComplete:"altitude"}),Object(p.jsx)(d.y,{className:"help-block",children:"Veuillez entrer l'altitude (ex: 45)"})]}),Object(p.jsxs)(d.x,{children:[Object(p.jsx)(r.a,{label:"D\xe9partement*:",name:"departement",type:"select",options:ie,placeholder:"Entrer le d\xe9partement de l'essai..."}),Object(p.jsx)(d.y,{className:"help-block",children:"Veuillez entrer le d\xe9partement de l'essai"})]})]})]})}),Object(p.jsx)(d.l,{xs:"12",sm:"6",children:Object(p.jsxs)(d.g,{children:[Object(p.jsxs)(d.k,{children:["Informations sur l'essai   ",t.params.id]}),Object(p.jsxs)(d.h,{children:[Object(p.jsxs)(d.x,{children:[Object(p.jsx)(r.a,{label:"Date de r\xe9alisation: (jj/mm/aaaa)",name:"dateRealisation",type:"text",placeholder:"Entrer la date de r\xe9alisation de l'essai",autoComplete:"dateRealisation"}),Object(p.jsx)(d.y,{className:"help-block",children:"Veuillez entrer la date de r\xe9alisation de l'essai (format: Jour/Mois/Ann\xe9e)"})]}),Object(p.jsxs)(d.x,{children:[Object(p.jsx)(r.a,{label:"Code de l'essai:",name:"code",type:"text",placeholder:"Entrer le code de l'essai",autoComplete:"code"}),Object(p.jsx)(d.y,{className:"help-block",children:"Veuillez entrer le code de l'essai"})]}),Object(p.jsxs)(d.x,{children:[Object(p.jsx)(r.a,{label:"Mots cl\xe9s:",name:"motsCles",type:"textarea",placeholder:"Entrer les mots cl\xe9s",autoComplete:"motsCles"}),Object(p.jsx)(d.y,{className:"help-block",children:"Veuillez entrer les mots cl\xe9s"})]}),Object(p.jsxs)(d.x,{children:[Object(p.jsx)(r.a,{label:"Commentaires:",name:"commentaire",type:"textarea",placeholder:"Entrer les commentaires",autoComplete:"commentaire"}),Object(p.jsx)(d.y,{className:"help-block",children:"Veuillez entrer un commentaire"})]}),Object(p.jsx)(d.x,{row:!0,children:Object(p.jsxs)(d.l,{xs:"12",md:"12",children:[Object(p.jsx)("input",{id:"custom-file-input",type:"file",accept:"application/pdf",onChange:function(e){return re(e)}}),Object(p.jsx)(d.J,{htmlFor:"custom-file-input",variant:"custom-file",children:v.file?v.file.name:"Choisir un fichier..."})]})}),I||ue?"":Object(p.jsx)(d.x,{row:!0,children:Object(p.jsx)(d.l,{xs:"12",md:"12",children:Object(p.jsx)(d.y,{className:"help-block",children:Object(p.jsx)("span",{style:{color:"red"},children:"Choisir un PDF*"})})})})]}),I?Object(p.jsx)(d.x,{row:!0,children:Object(p.jsx)(d.l,{xs:"12",md:"12",children:Object(p.jsxs)(d.y,{className:"help-block",children:[" Ancien PDF:  ",I?I.nomFichier:""]})})}):"",Object(p.jsxs)(d.i,{children:[Object(p.jsxs)("button",{className:"btn btn-dark mt-3",type:"submit",disabled:pe,children:[t.params.id?"Modifier":"Enregistrer",Object(p.jsx)(m.a,{loading:pe,size:15})]}),Object(p.jsx)("button",{className:"btn btn-danger mt-3 ml-3",type:"reset",children:"R\xe9initialiser"})]})]})})]})]})})}}),Object(p.jsx)(d.l,{sm:"12",lg:"6",children:Object(p.jsx)(d.ab,{position:"top-right",children:Object(p.jsxs)(d.X,{show:b,autohide:4e3,fade:!0,children:[Object(p.jsx)(d.Z,{closeButton:!0,children:Object(p.jsx)(d.b,{className:"mr-1",color:"success",children:"SUCC\xc8S"})}),Object(p.jsx)(d.Y,{color:"success",children:"Op\xe9ration r\xe9ussie !"})]})})}),Object(p.jsx)(d.l,{sm:"12",lg:"6",children:Object(p.jsx)(d.ab,{position:"top-right",children:Object(p.jsxs)(d.X,{show:y,autohide:4e3,fade:!0,children:[Object(p.jsx)(d.Z,{closeButton:!0,children:Object(p.jsx)(d.b,{className:"mr-1",color:"danger",children:"ECHEC"})}),Object(p.jsx)(d.Y,{color:"success",children:"Echec de l'op\xe9ration. Veuillez essayer plus tard !"})]})})})]})}}}]);
//# sourceMappingURL=14.b3b812f8.chunk.js.map